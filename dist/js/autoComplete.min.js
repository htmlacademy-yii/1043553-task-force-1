var a,b;a=this,b=function(){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function s(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw r}}}}function u(e){return"<span class=".concat(t,">").concat(e,"</span>")}function a(e){return e.innerHTML=""}function d(t,e,n,i,o,r){i({event:t,query:e instanceof HTMLInputElement?e.value:e.innerHTML,matches:o.matches,results:o.list.map(function(e){return e.value}),selection:o.list.find(function(e){return t.keyCode===m?e.index===Number(r.getAttribute(h)):"mousedown"===t.type?e.index===Number(t.currentTarget.getAttribute(h)):void 0})}),a(n)}function c(t,n,i,o){function r(e){c.classList.remove(v),s=1===e?c.nextSibling:c.previousSibling}function a(e){(c=e).classList.add(v)}var s,l=n.childNodes,u=l.length-1,c=void 0;t.onkeydown=function(e){if(0<l.length)switch(e.keyCode){case p:e.preventDefault(),c?(r(0),a(s||l[u])):a(l[u]);break;case y:c?(r(1),a(s||l[0])):a(l[0]);break;case m:c&&d(e,t,n,i,o,c)}},l.forEach(function(e){e.onmousedown=function(e){return d(e,t,n,i,o)}})}function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}var h="data-id",n="autoComplete_list",f="autoComplete_result",t="autoComplete_highlighted",v="autoComplete_selected",m=13,p=38,y=40,J=function(e){return"string"==typeof e?document.querySelector(e):e()},K=function(e){var t=document.createElement(e.element);return t.setAttribute("id",n),e.container&&e.container(t),e.destination.insertAdjacentElement(e.position,t),t};e.prototype=window.Event.prototype;var g={CustomEventWrapper:"function"==typeof window.CustomEvent&&window.CustomEvent||e,initElementClosestPolyfill:function(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null})}};return function(){function G(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,G);var t=e.selector,n=void 0===t?"#autoComplete":t,i=e.data,o=i.key,r=i.src,a=i.cache,s=void 0===a||a,l=e.query,u=e.trigger,c=(u=void 0===u?{}:u).event,d=void 0===c?["input"]:c,h=u.condition,f=void 0!==h&&h,v=e.searchEngine,m=void 0===v?"strict":v,p=e.threshold,y=void 0===p?0:p,g=e.debounce,b=void 0===g?0:g,E=e.resultsList,w=(E=void 0===E?{}:E).render,C=void 0!==w&&w,S=E.container,L=void 0!==S&&S,k=E.destination,x=E.position,A=void 0===x?"afterend":x,T=E.element,M=void 0===T?"ul":T,R=E.navigation,q=void 0!==R&&R,H=e.sort,I=void 0!==H&&H,j=e.placeHolder,P=e.maxResults,N=void 0===P?5:P,_=e.resultItem,O=(_=void 0===_?{}:_).content,V=void 0!==O&&O,D=_.element,W=void 0===D?"li":D,F=e.noResults,U=e.highlight,$=void 0!==U&&U,z=e.onSelection,B=C?K({container:L,destination:k||J(n),position:A,element:M}):null;this.selector=n,this.data={src:function(){return"function"==typeof r?r():r},key:o,cache:s},this.query=l,this.trigger={event:d,condition:f},this.searchEngine="loose"===m?"loose":"function"==typeof m?m:"strict",this.threshold=y,this.debounce=b,this.resultsList={render:C,view:B,navigation:q},this.sort=I,this.placeHolder=j,this.maxResults=N,this.resultItem={content:V,element:W},this.noResults=F,this.highlight=$,this.onSelection=z,this.init()}var e,t,n;return e=G,(t=[{key:"search",value:function(e,t){var n=t.toLowerCase();if("loose"===this.searchEngine){e=e.replace(/ /g,"");for(var i=[],o=0,r=0;r<n.length;r++){var a=t[r];o<e.length&&n[r]===e[o]&&(a=this.highlight?u(a):a,o++),i.push(a)}return o!==e.length?!1:i.join("")}if(n.includes(e))return e=new RegExp("".concat(e),"i").exec(t),this.highlight?t.replace(e,u(e)):t}},{key:"listMatchedResults",value:function(n){var a=this;return new Promise(function(e){var r=[];n.filter(function(i,o){function e(e){var t,n=e?i[e]:i;n&&((t="function"==typeof a.searchEngine?a.searchEngine(a.queryValue,n):a.search(a.queryValue,n))&&e?r.push({key:e,index:o,match:t,value:i}):t&&!e&&r.push({index:o,match:t,value:i}))}if(a.data.key){var t,n=s(a.data.key);try{for(n.s();!(t=n.n()).done;){e(t.value)}}catch(e){n.e(e)}finally{n.f()}}else e()});var t=a.sort?r.sort(a.sort).slice(0,a.maxResults):r.slice(0,a.maxResults);return e({matches:r.length,list:t})})}},{key:"ignite",value:function(){var l=this,u=J(this.selector);this.placeHolder&&u.setAttribute("placeholder",this.placeHolder);function r(n){function i(e,t){u.dispatchEvent(new g.CustomEventWrapper("autoComplete",{bubbles:!0,detail:{event:e,input:o,query:r,matches:t?t.matches:null,results:t?t.list:null},cancelable:!0}))}var s,o=u instanceof HTMLInputElement||u instanceof HTMLTextAreaElement?u.value.toLowerCase():u.innerHTML.toLowerCase(),r=l.queryValue=l.query&&l.query.manipulate?l.query.manipulate(o):o,e=l.resultsList.render,t=l.trigger.condition?l.trigger.condition(r):r.length>=l.threshold&&r.replace(/ /g,"").length;e?(s=l.resultsList.view,a(s),t?l.listMatchedResults(l.dataStream,n).then(function(e){var t,o,r,a;i(n,e),l.resultsList.render&&(0===e.list.length&&l.noResults?l.noResults():(t=s,o=e.list,r=l.resultItem,a=document.createDocumentFragment(),o.forEach(function(e,t){var n=document.createElement(r.element),i=o[t].index;n.setAttribute(h,i),n.setAttribute("class",f),r.content?r.content(e,n):n.innerHTML=e.match||e,a.appendChild(n)}),t.appendChild(a),l.onSelection&&(l.resultsList.navigation?l.resultsList.navigation(n,u,s,l.onSelection,e):c(u,s,l.onSelection,e))))}):i(n)):!e&&t&&l.listMatchedResults(l.dataStream,n).then(function(e){i(n,e)})}this.trigger.event.forEach(function(e){var n,i,o;u.addEventListener(e,(n=function(e){return t=e,void Promise.resolve(l.data.cache?l.dataStream:l.data.src()).then(function(e){l.dataStream=e,r(t)});var t},i=l.debounce,function(){var e=this,t=arguments;clearTimeout(o),o=setTimeout(function(){return n.apply(e,t)},i)}))})}},{key:"init",value:function(){var t=this;this.data.cache?Promise.resolve(this.data.src()).then(function(e){t.dataStream=e,t.ignite()}):this.ignite(),g.initElementClosestPolyfill()}}])&&i(e.prototype,t),n&&i(e,n),G}()},"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.autoComplete=b();
